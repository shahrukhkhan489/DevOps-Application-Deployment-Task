---
- hosts: all
  become: true
  tasks:
    
    - name: Clone OSRM Git Repository in /opt/OSRM Folder
      git: repo='https://github.com/Project-OSRM/osrm-backend.git' dest=/opt/OSRM update=no


    - name: Creating Build Directory for Compilation
      file: path=/opt/OSRM/build state=directory


    - name: Compiling OSRM binaries in Build Directory
      command: chdir=/opt/OSRM/build/ {{ item }}
      with_items:
       - cmake ..
       - cmake --build .

    - name: Installing OSRM binaries using CMAKE
      sudo: yes
      command: chdir=/opt/OSRM/build/ {{ item }}
      with_items: 
       - cmake --build . --target install

    - name: Grab a .osm.pbf extract from Geofabrik or Mapzen's Metro Extracts
      get_url: url=http://download.geofabrik.de/europe/germany/berlin-latest.osm.pbf dest=/opt/OSRM/build/berlin-latest.osm.pbf